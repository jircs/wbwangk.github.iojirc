IMPLEMENTING NFC SERVICE SECURITY – SE VS TEE VS HCE

Abstract: This document presents potential technologies for implementing security requirements of services that use Near Field Communication (NFC) technology. Depending on application design and its security requirements there are three possible alternatives for storing sensitive data and application code within NFC enabled mobile phone: secure element (SE), Trusted Execution Environment (TEE) and device’s operating system memory - using Host Card Emulation (HCE) service. Paper provides comparative analysis of mentioned alternatives in terms of technical issues as well as business ones. 

Keywords: NFC, Secure Element (SE), Trusted Execution Environment (TEE), Host Card Emulation (HCE)

1. INTRODUCTION

Until recently, we had ID cards, driving licence, healthcare card, loyalty cards and all other cards in the form of paper documents. In time, all those paper cards transformed into plastic cards – some of those called “smart” (the ones with chip). Today we have new trend coming up – transforming those plastic cards into applications – “virtual smart cards”- residing on our mobile phone. That mobile phone has the ability to interact with its surrounding using Near Field Communication (NFC) technology – wireless standard based on the same principles as RFID, that allows communication between two devices within maximum distance of 10 cm. NFC allows user to exchange the data from “virtual smart card” on the phone with reader (e.g. POS terminal) in contactless fashion. All he has to do is to “tap”.

By using NFC mobile phone, one could tap his phone to pay the bill, open the door of his home or office, use public transportation or send parking ticket. Use cases are numerous. However, in order to achieve that, many open questions must be resolved. Many of those questions are related to security. For an example, if NFC payment service should be implemented, where those sensitive personalized data and applications could be stored, in order to achieve the same security level as with classic payment smart-card (such as Visa or MasterCard)? Could it be in memory of operating system or in some dedicated hardware that will provide tamper-resistant environment? How any of these solutions should be implemented and what are the pros & cons of each? Following aims to give preview of possible answers to this security related questions.

2. SECURE ELEMENT (SE)

A secure element (SE) is a tamper-resistant platform (typically a one chip secure microcontroller) capable of securely hosting applications and their confidential and cryptographic data (e.g. key management) in accordance with the rules and security requirements set forth by a set of well-identified trusted authorities (GlobalPlatform, 2014). To put it more simple – SE is a smart cart in mobile phone (Lepojevic, 2012). As 1 such, SE provides the highest level of security for applications residing on it (SE level of security is the same as security level of classic smart cards).

There are three different form factors of SE: Universal Integrated Circuit Card (UICC), embedded SE (eSE) and microSD. UICC is advanced type of SIM card. eSE is smart card soldered to device’s main board. Third is also smart card chip in form factor of microSD. While the UICC and microSD are removable, eSE is not (part of mobile phone hardware). All SE form factors are complying to the GlobalPlatform and EMV standards (Lepojevic, 2012). 

Each form factor links to a different business implementation and satisfies a different market need. While UICC, as advanced version of SIM card, is controlled by the Mobile Network Operator (MNO), eSE, as a part of mobile phone, is being controlled by mobile phone manufacturer. In order for service provider (SP) to use UICC to host its application, SP must make business agreement with MNO. In the case of eSE, agreement must be made with mobile phone manufacturer. On the other hand, when microSD is about, SPs need to make arrangements with each other (to share the space on microSD) in order not to force user to have multiple microSD cards - for each NFC service. To reach acceptable agreement between any of these parties happened to be not so easy in practise, because each party wanted to hold favourable business position. That is why these agreements weren’t achievable easy and, despite high security and standardization of the SE, it hasn’t reached mass market so far.

3. TRUSTED EXECUTION ENVIRONMENT (TEE)

The TEE is a separate execution environment that runs alongside the mobile device’s OS (Rich OS1 ) and provides security services to that rich environment. The TEE offers an execution space that provides a higher level of security than a Rich OS; though not as secure as a secure element, the security offered by the TEE is sufficient for most applications. In this way, the TEE delivers a balance allowing for greater security than a Rich OS environment with considerably lower cost than an SE (Global Platform, 2011). 

TEE is secure area that resides in the main device processor (CPU), running its own operating system separated from device Rich OS, ensuring that data is stored, processed and protected in a trusted environment. As shown in the Figure 3, TEE provides safe execution of authorized security software - “trusted applications”. It also enforces protection, confidentiality, integrity and access rights of the resources and data belonging to those trusted applications (Global Platform, 2014). Inside TEE, each trusted applications is independent from the others and one trusted application can not access trusted resources from another trusted application – which enables secure storing of applications of many different service providers.

TEE provides layer of security between device OS (low security level) and SE (high security level). Although some NFC services such as payment or identification require high level of security (only provided by SE), there are applications that do not need to fulfil highest security standards, requiring, at the same time, better user experience and performance that resource-limited SE can’t provide. That is the peace of puzzle where TEE fits in, as a compromise between Rich OS performance and SE security (Global Platform, 2011).

It is important to note that TEE standardization is still in progress.

4.	HOST CARD EMULATION (HCE)
Android’s release 4.4., so-called “KitKat”, brought to life Host Card Emulation concept2. What is HCE? NFC device can operate in 3 modes: reader/writer mode, peer-to-peer mode and card emulation mode (CE). In first two modes NFC controller routes data to the host CPU (device OS), while when in card emulation mode data is routed towards SE. Android KitKat changed this – allowing commands in card emulation mode to be routed towards HCE service in CPU (Janssen & Zandstra, 2014). HCE service emulates contactless smart card or SE, allowing user’s device to act as smart card from the contactless reader perspective, without presence of actual smart card or SE (Consult Hyperion, 2013).

Although Android 4.4 changes the default routing behaviour in CE mode, it doesn’t prevent routing to SE in CE mode (Figure 3).Routing is based on application identifier (AID). When user taps his device to contactless terminal, terminal needs to “say” which application it wants to “talk to” – that is AID (Janssen & Zandstra, 2014; Android Developer, 2014). When this information reaches device’s NFC controller, it looks for that AID in its routing table. If AID is found in NFC controller routing table communication shell be routed to the SE – if not, communication flows by default to the appropriate HCE service in the device’s OS.

From the point of view of service provider – HCE looks quite good. No need for exhausting negotiation with MNO or mobile phone manufacturer, aimed at finding appropriate business model for using SE. No profit sharing. On the other hand, HCE has many functional drawbacks compared to SE (SimAlliance, 2014):
•	Low power mode (no function when battery runs out)
•	Roaming and “no data connectivity” scenario (no access to cloud)
•	Depending on connection speed

When it comes down to HCE security – many issues arise. Most of those regarding the case of Android “rooting”3. If Android is routed, attacker could access all the informations stored in the applications, including sensitive informations such as payment credentials. When “pure” HCE is about, there is no secure area for storing sensitive data, that could not be affected by rooting. Mitigating HCE related risks can be done in two different ways (Janssen & Zandstra, 2014):
•	Provide more secure location for storing sensitive data
•	Apply security mechanisms to make existing location more secure

In order to provide more secure location for sensitive data, storage and processing of sensitive data could be done in the “cloud”. Fundamental issue, when it comes to the “cloud security services”, is how to enable handset to securely identify itself to the cloud. This could be resolved by requiring user interaction for accessing the cloud, which would in turn negatively impact the user experience. Also, accessing the cloud poses functional question regarding need for constant and quick connection (e.g. according to the MasterCard standards mobile payment transaction must be completed within narrow time limit – up to 400ms for MasterCard PayPass M/Chip or 170ms for PayPass magstripe (MasterCard, 2013)), something that can not be guaranteed.

Second way to mitigate HCE risks is about applying security mechanisms. Tokenisation is one of those. Each time HCE service access the cloud, a number of tokens is issued to that HCE service. Token is “limited version of security information” (Consult Hyperion, 2013) that is valid for specific period of time (one hour, one day) or limited to specific number of transactions. Tokenisation partly solves problem with constant need for connection to the cloud. Besides tokenization, mechanisms that can mitigate HCE risks are user and hardware verification - based on “what user knows” (e.g. PIN code) , “what user has” (e.g. sticker) and “what user is” (biometrics like fingerprint scan) – as well as Android checks prior transaction (check if user has root privileges).

5.	CONCLUSION
Each of presented security solutions alternatives, when NFC services are about, has it’s pros & cons. Which security implementation to use for specific NFC service, depends on that service design and requirements. How secure should it be? Does it contain very sensitive data which, if compromised, can produce severe damage for the user? How important is user-experience and service performance? What is the estimation of extra costs, and is it affordable? Can we (as a service provider) do this on our own, or we need to form strategic partnership with other stakeholders (MNOs, smart card or mobile device manufacturers, security solution providers, etc)? These are just some of many question that must be taken into account in order to make appropriate choice when it comes to NFC service security.

From the technical point of view SE as an alternative has many advantages. It is mature technology, that provides high level of security. It is fully standardised and supported by the industry. Only technical drawback is it’s limited resources and low performance. From the business point of view, SE is complicated, because service providers need to make agreements with other actors in order to use and share space on the SE. It always comes down to question of ownership of the SE. The one who owns it has monopoly role in that business case.

HCE is solution for business drawbacks of SE alternative. It is “no secure element” – NoSE (Consult Hyperion, 2013) solution. Although it has great added value for SPs that can accept a reduced level of security in exchange for an improvement of other factors such as time to market, development costs and the need to cooperate with other parties, HCE has serious lacks when security is about. HCE can not be used for NFC services that require high level of security (such as open-loop payments, identification, access control). It should be perceived as more-simple-but-less-secure solution, intended to accelerate adoption of NFC services (Janssen & Zandstra, 2014; SimAlliance, 2014).

TEE is alternative “in the middle” on security scale. It provides much better security environment than HCE, with much lower cost than SE. Besides, it provides much better user experience and performance than SE. Main drawback of TEE is it’s not yet accomplished standardization process. However, TEE must be taken into account as a promising security solution alternative.

It is important to note that SE, TEE and HCE are not mutually exclusive. On the contrary. These security solutions can and should be used to complement each other.

1 Rich OS refers (in Global Platform terminology) to operating system of mobile device, which is considered to be untrusted and vulnerable to attacks.

2 HCE was already implemented by RIM’s Blackberry in 2011. But HCE is often referred as Android 4.4 feature, because Android dominates smart-phone market.

3 Android “rooting” is the process of allowing users of smart phones, tablets, and other devices running the Android mobile operating system to attain privileged control (known as "root access") within Android's sub-system.
